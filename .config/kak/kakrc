#= Map as soon as possible, in case of configuration errors
map global user c ':edit "%val{config}/kakrc"<ret>' -docstring 'Edit config'
map global user <a-c> ':source "%val{config}/kakrc"<ret>' -docstring 'Source config'

#= Plugins
source "%val{config}/plugins/plug.kak/rc/plug.kak"

plug "andreyorst/smarttab.kak" defer smarttab %{
    # when `backspace' is pressed, 4 spaces are deleted at once
    set-option global softtabstop 4
    # configure text that is being used to represent curent active mode
    set-option global smarttab_expandtab_mode_name 'exp'
    set-option global smarttab_noexpandtab_mode_name 'noexp'
    set-option global smarttab_smarttab_mode_name 'smart
} config %{
    hook global WinSetOption filetype=.* expandtab
    # # these languages will use `expandtab' behavior
    # hook global WinSetOption filetype=(rust|markdown|kak|lisp|scheme|sh|perl) expandtab
    # # these languages will use `noexpandtab' behavior
    # hook global WinSetOption filetype=(makefile|gas) noexpandtab
    # # these languages will use `smarttab' behavior
    # hook global WinSetOption filetype=(c|cpp) smarttab
}

plug "andreyorst/fzf.kak" config %{
    map global normal <minus> ': fzf-mode<ret>'
}

plug "danr/kakoune-easymotion" config %{
    # map global normal <a-g> ':enter-user-mode<space>easymotion<ret>'
    declare-user-mode jump
    map global jump c ':easy-motion-char<ret>' -docstring 'to char'
    map global jump w '<esc>:easy-motion-word<ret>' -docstring 'to word'
    map global jump g ':easy-motion-line<ret>' -docstring 'to line'
    map global normal <a-minus> ':enter-user-mode<space>jump<ret>'
}

plug "lePerdu/kakboard" %{
    # hook global WinCreate .* %{ kakboard-enable }
    map global user t ':kakboard-toggle<ret>' -docstring 'Kakboard toggle'
    map global user y ':kakboard-push-clipboard<ret>' -docstring 'Push clipboard'
    map global user p ':kakboard-pull-clipboard<ret>' -docstring 'Push clipboard'
}

plug 'delapouite/kakoune-mirror' %{
  map global user m ': enter-user-mode -lock mirror<ret>' -docstring 'Mirror mode'
}

plug "alexherbo2/prelude.kak"
plug "alexherbo2/connect.kak" config %{
    def connect-nnn %{
    	connect-terminal sh -c '(NNN_OPENER=edit nnn; NNN_OPENER=edit bash)'
    }
    map global user n ': connect-nnn<ret>' -docstring 'NNN'
}

plug "ul/kak-lsp" do %{
    # Install only when it doesn't exist.
    command -v kak-lsp >/dev/null 2>&1 || cargo install --locked --force --path .
}

# plug "lenormf/kakoune-extra"

plug "occivink/kakoune-find"

plug "https://gitlab.com/Screwtapello/kakoune-inc-dec"


#= Trailing whitespace errors
# Fix trailing whitespace errors
define-command trailine-whitespace-errors-fix -docstring '
Removes trailing whitespace errors
' %{
    try %{
        execute-keys -draft \% s \h+$ <ret> d
    } catch %{
        echo "No trailing whitespace errors"
    }
}


# Show trailing white space errors (except in insert mode)
define-command trailing-whitespace-errors-show -docstring '
Shows trailing whitespace errors
' %{
    add-highlighter global/trailing-whitespace-error regex \h+$ 0:black,red
}
define-command trailing-whitespace-errors-hide -docstring '
Hide trailing whitespace errors
' %{
    remove-highlighter global/trailing-whitespace-error
}
trailing-whitespace-errors-show
hook global ModeChange push:normal:insert -group trailine-whitespace-errors trailing-whitespace-errors-hide
hook global ModeChange pop:insert:normal -group trailine-whitespace-errors trailing-whitespace-errors-show


#= Auto save
# - use draft to avoid clearing echo line, so for example ':echo abc' will be able to show its output
hook global NormalIdle .* -group auto-save 'try %{ exec -draft :w<ret>}'
hook global ModeChange pop:insert:normal -group auto-save 'try %{exec -draft :w<ret>}'

#= Options
# set-option global extra_word_chars '_' '-'

#= Mappings
map global user / ':comment-line<ret>' -docstring 'Toggle comment'

declare-user-mode project
map global project b ':make build:debug<ret>' -docstring 'build debug'
map global project r ':make build:debug run<ret>' -docstring 'run debug'
map global normal <=> ':enter-user-mode<space>project<ret>'

#= Colorscheme
# colorscheme base16

#= Imports
source "%val{config}/filetype/haxe.kak"
source "%val{config}/filetype/cocoapods.kak"
source "%val{config}/filetype/gradle.kak"
source "%val{config}/filetype/makefile.kak"

# source "%val{config}/expand-tab.kak"


